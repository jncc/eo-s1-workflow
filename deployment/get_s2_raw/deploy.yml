---
- name: Clear temp directory for s2-downloader
  file:
    path: /luigi/temp/workflows/sentinel/2/downloader
    state: absent

- name: Ensure temp directory for s2-download exists
  file:
    path: /luigi/temp/workflows/sentinel/2/downloader
    state: directory
    owner: ubuntu
    recurse: yes

# Space at front of value to prevent it being recognised as a python variable and the quotes stripped to single quotes
- name: Modify pathroots in cfg file for S2 Tasks
  ini_file:
    path: /luigi/workflows/luigi.cfg
    section: GetS2RawProducts
    option: pathroots
    value: " {\"state-localRoot\": \"/luigi/temp/workflows/sentinel/2/downloader\", \"state-s3Root\": \"s3://{{ bucket-prefix }}-{{ current_env }}/workflows/sentinel/2/downloader\", \"product-s3Root\": \"s3://{{ bucket-prefix }}-{{ current_env }}/sentinel/2/raw\"}"

- name: Modify ceda user in cfg file for S2 Tasks
  ini_file:
    path: /luigi/workflows/luigi.cfg
    section: GetS2RawProducts
    option: cedaFtpUser
    value: "{{ ceda_ftp_user }}"

- name: Modify ceda password in cfg file for S2 Tasks
  ini_file:
    path: /luigi/workflows/luigi.cfg
    section: GetS2RawProducts
    option: cedaFtpPassword
    value: "{{ ceda_ftp_password }}"

- name: Ensure seed folder for S2 Downloader exists
  file:
    path: /luigi/temp/workflows/sentinel/2/downloader/2017-11-04
    state: directory
    owner: ubuntu

- name: Create seed file - AvailableProducts
  copy:
    src: /luigi/workflows/get_s2_raw/seed/AvailableProducts.json
    dest: /luigi/temp/workflows/sentinel/2/downloader/2017-11-04/AvailableProducts.json
    remote_src: yes
    owner: ubuntu
  
- name: Create seed file - S2RawProducts
  copy:
    src: /luigi/workflows/get_s2_raw/seed/S2RawProducts.json
    dest: /luigi/temp/workflows/sentinel/2/downloader/2017-11-04/S2RawProducts.json
    remote_src: yes
    owner: ubuntu
