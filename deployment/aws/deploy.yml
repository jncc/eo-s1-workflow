---
- name: Get users home directory
  shell: >
    getent passwd {{ aws_cli_user }} | cut -d: -f6
  changed_when: false
  register: home_dir

- name: Create AWS config directory for user
  tags: aws-cli
  become: yes
  file:
    path: '{{ home_dir }}/.aws'
    state: directory
    owner: '{{ aws_cli_user }}'
    group: '{{ aws_cli_group }}'
    mode: 0755

- name: Template aws credentials for user
  tags: aws-cli
  become: yes
  template:
    src: ./deployment/aws/templates/credentials.j2
    dest: '{{ home_dir }}/.aws/credentials'
    owner: '{{ aws_cli_user }}'
    group: '{{ aws_cli_group }}'
    mode: 0600

- name: Template aws config for user
  tags: aws-cli
  become: yes
  template:
    src: ./deployment/aws/templates/config.j2
    dest: '{{ home_dir }}/.aws/config'
    owner: '{{ aws_cli_user }}'
    group: '{{ aws_cli_group }}'
    mode: 0600